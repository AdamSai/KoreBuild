<Project>
  <Target Name="Build">
    <PropertyGroup>
      <ShadeDirectory>$(MSBuildThisFileDirectory)../shade/</ShadeDirectory>
      <SakeExecutable>$([MSBuild]::EnsureTrailingSlash('$(NuGetPackageRoot)'))sake/$(SakeVersion)/tools/Sake.exe</SakeExecutable>
      <SakeExecutable Condition="'$(OS)'!='Windows_NT'">mono $(SakeExecutable)</SakeExecutable>
      <MakeFilePath>$(ShadeDirectory)makefile.shade</MakeFilePath>
      <MakeFilePath Condition="Exists('$(RepositoryRoot)makefile.shade')">$(RepositoryRoot)makefile.shade</MakeFilePath>

      <!-- workaround https://github.com/Microsoft/msbuild/issues/429 -->
      <MakeFilePath Condition="'$(OS)'=='Windows_NT'">$([MSBuild]::MakeRelative('$(RepositoryRoot)', '$(MakeFilePath)'))</MakeFilePath>
      <MakeFilePath Condition="'$(OS)'!='Windows_NT'">$([MSBuild]::MakeRelative('file://$(RepositoryRoot)', 'file://$(MakeFilePath)'))</MakeFilePath>

      <SakeTargets Condition="'$(SakeTargets)' != '' ">$(SakeTargets.Replace(':', ' '))</SakeTargets>
      <SakeTargets Condition="'$(NoRestore)'=='true'">--no-restore $(SakeTargets)</SakeTargets>
      <SakeTargets Condition="'$(MakeQuiet)'=='true'">--quiet $(SakeTargets)</SakeTargets>
    </PropertyGroup>

    <Exec
      Command="$(SakeExecutable) -I &quot;$(MSBuildThisFileDirectory)../shade&quot; -f $(MakeFilePath) $(SakeTargets)"
      WorkingDirectory="$(RepositoryRoot)"
      IgnoreStandardErrorWarningFormat="true" />
  </Target>
</Project>